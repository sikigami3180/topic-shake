<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
  </head>

  <body>
    <button onclick="permission_request();">
      加速度センサーへのアクセス許可
    </button>
    話題に困った時に振るやつ
    <div id="num">aaa</div>
    <div id="result_acc">bbb</div>
    <br />
    <div id="result_gyro">ccc</div>
    <script type="text/javascript">
      var num = 10;
      function add_event_listener() {
        window.addEventListener("devicemotion", function (event) {
            var x = event.acceleration.x;
            var y = event.acceleration.y;
            var z = event.acceleration.z;
            console.log(x, y, z);

            var result1 = document.getElementById("result_acc");
            result1.innerHTML =
              "重力加速度<br />" +
              "X：" +
              x.toFixed(2) +
              "(m/s^2)<br />" +
              "Y：" +
              y.toFixed(2) +
              "(m/s^2)<br />" +
              "Z：" +
              z.toFixed(2) +
              "(m/s^2)<br />";
          },
          true
        );
      }
      function post_function(result_string) {
        if (result_string === "granted") {
          // ユーザが許可した場合、文字列"granted"が返る
          add_event_listener();
        } else if (result_string === "denied") {
          // ユーザが拒否した場合、文字列"denied"が返る
        }
      }
      function permission_request() {
        if (
          DeviceOrientationEvent &&
          DeviceOrientationEvent.requestPermission &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          DeviceMotionEvent.requestPermission().then(add_event_listener);
        }
        else {
          add_event_listener();
        }
      }
      var res = document.getElementById("num");
      res.innerText = String(num);
    </script>
  </body>
</html>
