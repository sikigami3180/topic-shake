<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>

<body>

  <button onclick="permission_request();">動作と方向へのアクセス許可</button>
  話題に困った時に振るやつ
  <div id="num">
    aaa
  </div>
  <div id="result_acc">
    aaa
  </div>
  <br />
  <div id="result_gyro">
    bbb
  </div>
  <script type="text/javascript">
    var num = 10;
    function post_function(result_string) {
      if (result_string === "granted") {
        // ユーザが許可した場合、文字列"granted"が返る
      }
      else if (result_string === "denied") {
        // ユーザが拒否した場合、文字列"denied"が返る
      }
    }
    function permission_request() {
      if (DeviceOrientationEvent
        && DeviceOrientationEvent.requestPermission
        && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceMotionEvent.requestPermission().then(post_function);
        window.addEventListener("devicemotion", function (event) {
          // 何らかの処理
          var x = event.acceleration.x;
          var y = event.acceleration.y;
          var z = event.acceleration.z;
          console.log(x, y, z);

          var result1 = document.getElementById("result_acc");
          result1.innerHTML = "重力加速度<br />" +
            "X：" + x.toFixed(2) + "(m/s^2)<br />" +
            "Y：" + y.toFixed(2) + "(m/s^2)<br />" +
            "Z：" + z.toFixed(2) + "(m/s^2)<br />";
        }, true);
      }
      if (DeviceOrientationEvent
        && DeviceOrientationEvent.requestPermission
        && typeof DeviceOrientationEvent.requestPermission === 'function'
      ) {
        DeviceOrientationEvent.requestPermission().then(post_function);
        window.addEventListener("deviceorientation", function (event) {
          // 何らかの処理
          var alpha = event.alpha;
          var beta = event.beta;
          var gamma = event.gamma;

          var result2 = document.getElementById("result_gyro");
          result2.innerHTML = "ジャイロセンサー<br />" +
            "alpha：" + alpha.toFixed(2) + "°<br />" +
            "beta ：" + beta.toFixed(2) + "°<br />" +
            "gamma：" + gamma.toFixed(2) + "°<br />";
        }, true);
      }
    }
    var res = document.getElementById("num");
    res.innerText = String(num);
  </script>
</body>

</html>
